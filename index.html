<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è´¦å·å¯†ç ç®¡ç†å™¨</title>
<link rel="icon" href="images/book.png">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
/* ===== åŸ V3 CSSï¼Œå®Œå…¨æœªæ”¹ ===== */
*{margin:0;padding:0;box-sizing:border-box}
body{
font-family:'Microsoft YaHei',Arial;
background:linear-gradient(135deg,#a8e6cf,#dcedc8,#f0f4c3);
min-height:100vh;padding:20px;color:#333}
.container{max-width:1400px;margin:0 auto}
.header{display:grid;grid-template-columns:auto auto 1fr;align-items:center;margin-bottom:30px;color:#2e7d32}
.header h1{font-size:2.5rem}
.accounts-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:15px}
.account-card{
background:rgba(255,255,255,.95);
border-radius:15px;padding:8px;
box-shadow:0 8px 25px rgba(0,0,0,.1);
transition:.3s;cursor:move;position:relative}
.account-card:hover{transform:translateY(-5px) scale(1.01)}
.system-name{
font-size:1.2rem;font-weight:bold;color:#2e7d32;
padding:6px 36px 6px 10px;border-bottom:2px solid #c8e6c9;
position:relative}
.account-item{display:flex;gap:10px;padding:6px 10px}
.item-label{color:#4caf50;width:40px}
.item-value{
flex:1;background:#f1f8e9;border:2px solid #c8e6c9;
border-radius:8px;padding:6px 10px;cursor:pointer}
.menu{
position:absolute;right:6px;top:6px;cursor:pointer;font-size:18px}
.menu-panel{
display:none;position:absolute;right:0;top:20px;
background:#fff;border-radius:8px;
box-shadow:0 4px 15px rgba(0,0,0,.2)}
.menu:hover .menu-panel{display:block}
.menu-panel div{
padding:8px 14px;color:#c62828;cursor:pointer}
.menu-panel div:hover{background:#ffebee}
.add-btn{
position:fixed;right:26px;bottom:26px;
width:54px;height:54px;border-radius:50%;
background:#4caf50;color:#fff;font-size:30px;
border:none;cursor:pointer;box-shadow:0 8px 20px rgba(0,0,0,.2)}
.modal{
display:none;position:fixed;inset:0;
background:rgba(0,0,0,.45);
align-items:center;justify-content:center}
.modal-content{
background:#fff;padding:20px;border-radius:16px;width:340px}
.modal-content input{
width:100%;margin-bottom:10px;padding:8px}
.modal-content button{
width:100%;padding:10px;background:#4caf50;
color:#fff;border:none;border-radius:8px}
</style>
</head>

<body>

<div class="container">
  <div class="header">
    <h1>ğŸ” è´¦å·å¯†ç ç®¡ç†å™¨</h1>
  </div>
  <div class="accounts-grid" id="accountsGrid"></div>
</div>

<button class="add-btn" onclick="openModal()">ï¼‹</button>

<div class="modal" id="modal">
  <div class="modal-content">
    <input id="sys" placeholder="ç³»ç»Ÿåç§°">
    <input id="user" placeholder="è´¦å·">
    <input id="pwd" placeholder="å¯†ç ">
    <input id="url" placeholder="URLï¼ˆå¯é€‰ï¼‰">
    <button onclick="addAccount()">ä¿å­˜</button>
  </div>
</div>

<script>
/* ===== Supabase é…ç½®ï¼ˆåªæ”¹è¿™é‡Œï¼‰ ===== */
const SUPABASE_URL = 'https://lxuomiimbnterkxzquba.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx4dW9taWltYm50ZXJreHpxdWJhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY5MzYyNDksImV4cCI6MjA4MjUxMjI0OX0.LZOFm_VS0y5UF0vBR8y2y90Wrq_cMmIvggnXL_JM6h0';
/* =================================== */

const supabase = supabaseJs.createClient(SUPABASE_URL, SUPABASE_KEY);
const grid = document.getElementById('accountsGrid');
let draggedCard = null;

/* åŠ è½½æ•°æ® */
async function loadAccounts(){
  const { data } = await supabase
    .from('accounts')
    .select('*')
    .order('sort_order');
  grid.innerHTML='';
  data.forEach(renderCard);
}

/* æ¸²æŸ“å¡ç‰‡ï¼ˆå®Œå…¨ä¿ç•™ V3 é£æ ¼ï¼‰ */
function renderCard(a){
  const card=document.createElement('div');
  card.className='account-card';
  card.draggable=true;
  card.dataset.id=a.id;

  card.innerHTML=`
    <div class="menu">â‹®
      <div class="menu-panel">
        <div onclick="removeAccount('${a.id}')">åˆ é™¤</div>
      </div>
    </div>
    <div class="system-name">${a.system}</div>
    <div class="account-item">
      <div class="item-label">è´¦å·</div>
      <div class="item-value" onclick="copyText('${a.username}')">${a.username}</div>
    </div>
    <div class="account-item">
      <div class="item-label">å¯†ç </div>
      <div class="item-value" onclick="copyText('${a.password}')">${a.password}</div>
    </div>
  `;

  card.addEventListener('dragstart',()=>draggedCard=card);
  card.addEventListener('dragover',e=>e.preventDefault());
  card.addEventListener('drop',()=>onDrop(card));
  grid.appendChild(card);
}

/* æ‹–æ‹½æ’åºä¿å­˜ */
async function onDrop(target){
  if(draggedCard!==target){
    grid.insertBefore(draggedCard,target);
    await saveOrder();
  }
}
async function saveOrder(){
  const updates=[...grid.children].map((c,i)=>({
    id:c.dataset.id,sort_order:i+1
  }));
  await supabase.from('accounts').upsert(updates);
}

/* æ–°å¢ */
function openModal(){modal.style.display='flex'}
async function addAccount(){
  const { data:max }=await supabase.from('accounts')
    .select('sort_order').order('sort_order',{ascending:false})
    .limit(1).single();
  await supabase.from('accounts').insert([{
    system:sys.value,
    username:user.value,
    password:pwd.value,
    url:url.value,
    sort_order:(max?.sort_order||0)+1
  }]);
  modal.style.display='none';
  loadAccounts();
}

/* åˆ é™¤ï¼ˆé˜²è¯¯è§¦ï¼‰ */
async function removeAccount(id){
  if(confirm('ç¡®è®¤åˆ é™¤ï¼Ÿ')){
    await supabase.from('accounts').delete().eq('id',id);
    loadAccounts();
  }
}

/* å¤åˆ¶ */
function copyText(t){navigator.clipboard.writeText(t)}

loadAccounts();
</script>
</body>
</html>
