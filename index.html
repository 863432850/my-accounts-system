<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è´¦å·å¯†ç ç®¡ç†å™¨ V5.1</title>
    <script src="./mincloud.js"></script>
    <style>
        /* ç»§æ‰¿ä½ åŸæœ‰çš„æ ·å¼ */
        body { font-family: sans-serif; background: #f0f4c3; padding: 20px; }
        .accounts-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; }
        .account-card { background: white; padding: 15px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .system-name { font-weight: bold; color: #2e7d32; border-bottom: 1px solid #eee; margin-bottom: 10px; }
        .loading { text-align: center; padding: 50px; font-size: 1.2rem; color: #666; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” è´¦å·ç®¡ç†å™¨</h1>
        <div id="statusInfo" style="color: #666; margin-bottom: 10px;">æ­£åœ¨è¿æ¥äº‘ç«¯...</div>
        <div class="accounts-grid" id="accountsGrid"></div>
    </div>

    <script>
        // 1. é…ç½®ä¿¡æ¯ (å·²æ ¹æ®ä½ çš„æˆªå›¾è‡ªåŠ¨å¡«å…¥)
        const CLIENT_ID = 'beb23e269f45432272c6'; 
        const TABLE_NAME = 'account_list';

        // 2. åˆå§‹åŒ–
        try {
            if (typeof BaaS !== 'undefined') {
                BaaS.init(CLIENT_ID);
                // å¼ºåˆ¶å¼€å¯è·¨åŸŸæ”¯æŒ
                BaaS._config.CORS = true; 
            } else {
                showError("SDK åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ mincloud.js æ˜¯å¦å·²ä¸Šä¼ åˆ° GitHub");
            }
        } catch (e) {
            showError("åˆå§‹åŒ–å¼‚å¸¸: " + e.message);
        }

        // 3. æ•°æ®è¯»å–
        async function loadData() {
            try {
                let table = new BaaS.TableObject(TABLE_NAME);
                // æŒ‰åˆ›å»ºæ—¶é—´å€’åºæ’åˆ—
                let res = await table.orderBy('-created_at').find();
                renderCards(res.data.objects);
                document.getElementById('statusInfo').textContent = "æ•°æ®æ›´æ–°äº: " + new Date().toLocaleTimeString();
            } catch (err) {
                console.error("åŠ è½½é”™è¯¯è¯¦æƒ…:", err);
                if (err.code === 403 || err.message.includes('CORS')) {
                    showError("ã€è·¨åŸŸæ‹¦æˆªã€‘è¯·å»çŸ¥æ™“äº‘åå°-å®‰å…¨è®¾ç½®-å°†å®‰å…¨åŸŸåè®¾ä¸º *");
                } else {
                    showError("åŠ è½½å¤±è´¥: " + (err.message || "è¯·æ£€æŸ¥è¡¨åæ˜¯å¦ä¸º account_list"));
                }
            }
        }

        function renderCards(objects) {
            const grid = document.getElementById('accountsGrid');
            grid.innerHTML = objects.length ? '' : 'äº‘ç«¯æš‚æ— æ•°æ®';
            objects.forEach(item => {
                const card = document.createElement('div');
                card.className = 'account-card';
                card.innerHTML = `
                    <div class="system-name">${item.system || 'æœªå‘½å'}</div>
                    <div style="font-size:0.9rem">è´¦å·: ${item.username}</div>
                    <div style="font-size:0.9rem">å¯†ç : ${item.password}</div>
                `;
                grid.appendChild(card);
            });
        }

        function showError(msg) {
            document.getElementById('accountsGrid').innerHTML = `<div style="color:red; border:1px solid red; padding:20px;">${msg}</div>`;
        }

        window.onload = loadData;
    </script>
</body>
</html>
