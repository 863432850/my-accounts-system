<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>动态账号管理</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<style>
    body { font-family: Arial, sans-serif; background: #f0f2f5; margin: 0; padding: 20px; }
    h1 { text-align: center; margin-bottom: 20px; }
    .container { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; }
    .card {
        background: #fff; border-radius: 12px; padding: 15px; width: 220px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        transition: transform 0.2s, box-shadow 0.2s; position: relative; cursor: grab;
    }
    .card:hover { transform: translateY(-3px); box-shadow: 0 8px 16px rgba(0,0,0,0.15); }
    .card h3 { margin: 0 0 10px; font-size: 18px; word-break: break-word; }
    .card p { margin: 5px 0; font-size: 14px; word-break: break-word; }
    .card .actions { margin-top: 10px; display: flex; gap: 5px; }
    button { cursor: pointer; padding: 5px 8px; border: none; border-radius: 6px; font-size: 13px; }
    .btn-edit { background: #4caf50; color: #fff; }
    .btn-delete { background: #f44336; color: #fff; }
    .btn-add { background: #2196f3; color: #fff; margin-bottom: 20px; }
    input[type="text"] { padding: 5px; width: 200px; border-radius: 6px; border: 1px solid #ccc; margin-bottom: 20px; }
    .highlight { background: linear-gradient(90deg, #ffefba, #ffffff); }
    .modal {
        display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 9999;
    }
    .modal-content {
        background: #fff; padding: 20px; border-radius: 12px; min-width: 300px; position: relative;
    }
    .modal-content input { width: 100%; margin-bottom: 10px; }
    .close { position: absolute; top: 10px; right: 15px; cursor: pointer; font-size: 18px; }
</style>
</head>
<body>
<h1>动态账号管理</h1>

<input type="text" id="search" placeholder="搜索账号或密码...">

<button class="btn-add" onclick="openModal()">新增账号</button>

<div class="container" id="cardContainer"></div>

<!-- 模态框 -->
<div class="modal" id="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h3 id="modalTitle">新增账号</h3>
        <input type="text" id="accountName" placeholder="账号名称">
        <input type="text" id="accountPassword" placeholder="账号密码">
        <button class="btn-add" onclick="saveAccount()">保存</button>
    </div>
</div>

<script>
const SUPABASE_URL = 'https://lxuomiimbnterkxzquba.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx4dW9taWltYm50ZXJreHpxdWJhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY5MzYyNDksImV4cCI6MjA4MjUxMjI0OX0.LZOFm_VS0y5UF0vBR8y2y90Wrq_cMmIvggnXL_JM6h0';

const supabase = supabase.createClient(supabaseUrl, supabaseKey);

let editId = null;

// 加载数据
async function loadAccounts() {
    const { data, error } = await supabase.from('accounts').select('*').order('sort_order', { ascending: true });
    const container = document.getElementById('cardContainer');
    container.innerHTML = '';
    data.forEach(item => {
        const card = document.createElement('div');
        card.className = 'card';
        card.setAttribute('data-id', item.id);
        card.innerHTML = `
            <h3>${item.name}</h3>
            <p>${item.password}</p>
            <div class="actions">
                <button class="btn-edit" onclick="editAccount('${item.id}', '${item.name}', '${item.password}')">编辑</button>
                <button class="btn-delete" onclick="deleteAccount('${item.id}')">删除</button>
            </div>
        `;
        container.appendChild(card);
    });
    enableDrag();
}

// 启用拖拽排序
function enableDrag() {
    const container = document.getElementById('cardContainer');
    Sortable.create(container, {
        animation: 150,
        onEnd: async function (evt) {
            const cards = container.querySelectorAll('.card');
            for (let i = 0; i < cards.length; i++) {
                const id = cards[i].getAttribute('data-id');
                await supabase.from('accounts').update({ sort_order: i }).eq('id', id);
            }
        }
    });
}

// 新增/编辑弹窗
function openModal() {
    editId = null;
    document.getElementById('modalTitle').innerText = '新增账号';
    document.getElementById('accountName').value = '';
    document.getElementById('accountPassword').value = '';
    document.getElementById('modal').style.display = 'flex';
}

function editAccount(id, name, password) {
    editId = id;
    document.getElementById('modalTitle').innerText = '编辑账号';
    document.getElementById('accountName').value = name;
    document.getElementById('accountPassword').value = password;
    document.getElementById('modal').style.display = 'flex';
}

function closeModal() {
    document.getElementById('modal').style.display = 'none';
}

// 保存账号
async function saveAccount() {
    const name = document.getElementById('accountName').value;
    const password = document.getElementById('accountPassword').value;

    if (editId) {
        await supabase.from('accounts').update({ name, password }).eq('id', editId);
    } else {
        const { data } = await supabase.from('accounts').select('*').order('sort_order', { ascending: false }).limit(1);
        const maxSort = data.length ? data[0].sort_order + 1 : 0;
        await supabase.from('accounts').insert([{ name, password, sort_order: maxSort }]);
    }

    closeModal();
    loadAccounts();
}

// 删除账号
async function deleteAccount(id) {
    if (confirm('确认删除该账号吗？')) {
        await supabase.from('accounts').delete().eq('id', id);
        loadAccounts();
    }
}

// 搜索功能
document.getElementById('search').addEventListener('input', (e) => {
    const query = e.target.value.toLowerCase();
    document.querySelectorAll('.card').forEach(card => {
        const text = card.innerText.toLowerCase();
        card.style.display = text.includes(query) ? 'block' : 'none';
        card.classList.toggle('highlight', text.includes(query));
    });
});

// 初始化
loadAccounts();
</script>
</body>
</html>
